# 马蹄看点笔记小程序 😅

> ## V 2.0 :  🤔
### 在看点笔记的基础上加入了“材料在线”功能：

> ## 材料在线介绍：  
> 1. 智能AI图片识别功能
> 1. 材料展示模块
> 1. 供应商展示模块  


 本次加入的功能主要用于根据图片识别产生“标签”，从而进行导购材料。主要技术是使用百度AI智能图像识别，由前端上传图片，匹配到相应标签后返回标签。  

 小程序这边，主要对一下功能进行了开发：  
 1. 图片剪裁功能：  
        此功能主要使用了[Sail](https://github.com/dlhandsome) 的canvas图片剪裁插件[https://github.com/we-plugin/we-cropper]。根据业务需求做了些许调整。  
        指的一提的是，本来用几乎相同的方法写了一个针对``<image>``标签缩放的功能。但是发现缩放过程中极为卡顿，一帧一帧的。看了下他的代码发现核心逻辑几乎一样，遂产生了canvas中调整大小不断set可能性能比较好的看法。所以直接使用了Sail的插件。感谢！ 🙏
2. 图库缩放并左右切换图片功能：  
        此功能套用了小程序官方提供的组件：可移动视图控件``<movable-area>``。  
        核心逻辑为：在``movable-area``中，设置``movable-view``为固定大小，定位居中，可缩放，最大为2倍最小为1倍，绑定滑动事件和缩放事件，点击图片以后将当前图片的所有数据set到``movable-view``的``image``组件中。至此，图片可以正常缩放，移动。在缩放事件中加入判断，缩放大小为1，也就是原始尺寸时，置变量为``true``，允许监控滑动事件。当滑动距离超过``100``后，关闭``movable-area``组件，切换图片，使用``wx:if``关闭的好处在于，再次更新图片并开启``movable-area``时，会重新渲染，不会造成上张图片缩放位移后，影响下一张。
3. 加入了定位功能：  
        后台传入每个商家的经纬度，由小程序原生函数``getLocation``获取到定位后，使用经纬度差值计算距离。
4. 增加了根据识别标签跳转到相应的材料导航：  
        在跳转时加上参数，材料列表页面``onShow``时，获取参数并使用原生控件的可滚动视图``scroll-view``的属性``scroll-into-view``滚动到相应的导航标签。值得说明的是，此方法不能再页面渲染成功或者页面打开后立即生效。😥目前不明白设置此现象是BUG还是有意为之，本次采用``setTimeout``来规避此现象。
5. 增加相应页面的渲染以及``点赞``，``回复``，``收藏``等功能

> ## V 1.0 😅

### 马蹄笔记小程序

本小程序主要有一下功能：

>1. 根据用户复制的微信文章链接，生成笔记文章。笔记文章仅有源文章的图片。用户可进行图片批量下载
>2. 可在小程序上浏览马蹄网的图库图片，并进行批量下载。
>3. 用户中心

技术上主要为批量下载图片一个新功能：  
     根据用户所选的图片，加入数组，设置同步下载，每下载成功一张图片再进行下一张的下载。



